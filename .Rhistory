stlh
log(1:6) + 2 - 1
expect_equal(stlh[, st_llh],
log(1:6) + 2 - 1)
stlh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1))
expect_equal(stlh[, st_llh],
log(1:6) + 2 - 1)
spacetime_llh <- function(full_llr, null_llh, L) {
full_llr[, .(st_llh = logsumexp(llr) + null_llh - log(L)),
keyby = .(event, region, time)]
}
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr[, llr := log(rep(1:6, each = 2) / 2)]
setkeyv(fullr, c("event", "region", "severity"))
# add 2, subtract 1 from logsumexp(llh)
stlh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1))
stlh
expect_equal(stlh[, st_llh],
log(1:6) + 2 - 1)
devtools::test()
fullr
devtools::test()
DT6
?Reduce
DT6 <- full_llr(DT5)
DT6 <- rbind(DT6, DT6)
DT6[, severity := c(rep(1, 12), rep(2, 12))]
DT6[, llr := c(1:12, 1:12) / 2]
setkeyv(DT6, c("event", "region", "severity"))
DT7 <- spacetime_llh(DT6)
DT7 <- spacetime_llh(DT6, 1, 0)
DT7
DT6
DT7 <- spacetime_llh(DT6, 0, 1)
DT7
DT6
f <- function(x, y) x * (1 + y)
ff <- function(v) Reduce(f, v, right = TRUE)
ff(1:3)
1 * (1 + 2) * (1 + 3)
1 * (1 + 2 * (1 + 3))
1 * (1 + 2 * (1 + 3 * (1 + 4)))
ff(1:4)
ff(4:1)
ff(1:30)
c(rep(1:4, 2), rep(2:5, 2), rep(3:6, 2))
DT6[, llr := c(rep(1:4, 2), rep(2:5, 2), rep(3:6, 2))]
DT6
DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)]
ff(2:5)
ff(3:6)
DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)][, lrsums := sum(lrsums),
keyby = .(event, region)]
DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)][, lr_sums := sum(lr_sums),
keyby = .(event, region)]
DT8 <- DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)][, lr_sums := sum(lr_sums),
keyby = .(event, region)]
DT8
DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)]
a <- DT6[, .(lr_sums = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)]
a
DT6[, .(lr_timesum = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)][, lr_sums := sum(lr_timesum),
keyby = .(event, region)]
DT6[, .(lr_timesum = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)]
a <- DT6[, .(lr_timesum = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)]
a
a[, lr_sums := sum(lr_timesum), keyby = .(event, region)]
DT8 <- DT6[, .(lr_timesum = Reduce(function(x, y) x * (1 + y), llr, right = TRUE)),
keyby = .(event, region, severity)][, lr_sums := sum(lr_timesum),
keyby = .(event, region)]
DT8
DT6 <- full_llr(DT5)
DT6 <- rbind(DT6, DT6)
DT6[, severity := c(rep(1, 12), rep(2, 12))]
DT6[, llr := c(1:12, 1:12) / 2]
setkeyv(DT6, c("event", "region", "severity"))
DT6
DT6[, llr := c(rep(1:4, 2), rep(2:5, 2), rep(3:6, 2))]
DT6
DT8 <- DT6[, .(lr_timesum = Reduce(function(x, y) x * (1 + y),
llr,
right = TRUE)),
keyby = .(event, region, severity)]
DT8
DT9 <- DT8[, lr_sums := sum(lr_timesum), keyby = .(event, region)]
DT9
DT9 <- DT8[, .(lr_sum = sum(lr_timesum)), keyby = .(event, region)]
DT9
devtools::test()
DT6 <- full_llr(DT5)
DT6 <- rbind(DT6, DT6)
DT6[, severity := c(rep(1, 12), rep(2, 12))]
DT6[, llr := c(1:12, 1:12) / 2]
setkeyv(DT6, c("event", "region", "severity"))
DT6[, llr := c(rep(1:4, 2), rep(2:5, 2), rep(3:6, 2))]
DT6
ff(3:1)
ff(1:3)
DT4
getkeys(DT4)
a <- rbind(DT4)
a <- rbind(DT4, DT4)
a
a[, time := rep(0:3, each = 3)]
a
a
setkey(a, "region")
a
a[, lq := 1:12]
a
setkeyv(a, c("time", "event", "severity", "region"))
a
sum_lr_over_time <- function(lq_table) {
lq_table[, .(lr_timesum = Reduce(function(x, y) x * (1 + y),
exp(lq),
right = TRUE)),
keyby = .(event, region, severity)]
}
fullr <- data.table(time = rep(0:3, 3),
event = rep(1, 12),
severity = rep(1, 12),
region = rep(1:3, each = 4),
lq = 1:12)
fullr
setkeyv(fullr, c("time", "event", "severity", "region"))
fullr
re <- sum_lr_over_time(fullr)
re
fullr <- data.table(time = rep(0:3, 3),
event = rep(1, 12),
severity = rep(1, 12),
region = rep(1:3, each = 4),
lq = 1:12)
fullr
fullr <- data.table(time = rep(0:3, 3),
event = rep(1, 12),
severity = rep(1, 12),
region = rep(1:3, each = 4),
lq = rep(1:4, 3))
fullr
setkeyv(fullr, c("time", "event", "severity", "region"))
re <- sum_lr_over_time(fullr)
re
fullr <- data.table(time = rep(0:3, 3),
event = rep(1, 12),
severity = rep(1, 12),
region = rep(1:3, each = 4),
lq = log(rep(1:4, 3)))
setkeyv(fullr, c("time", "event", "severity", "region"))
re <- sum_lr_over_time(fullr)
re
1 * (1 + 2 * (1 + 3 * (1 + 4)))
expect_equal(sum_lr_over_time(fullr),
rep(1 * (1 + 2 * (1 + 3 * (1 + 4))),
3))
res <- sum_lr_over_time(fullr)
res[, lr_timesum]
devtools::test()
devtools::test()
devtools::load_all()
devtools::load_all("~/Desktop/Thesis/scanstatistics")
?useDynLib
??useDynLib
devtools::test()
devtools::load_all()
library(data.table)
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr
fullr[, llr := log(rep(1:6, each = 2) / 2)]
fullr
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr
fullr[, llr := log(rep(1:3, each = 4) / 2)]
fullr
devtools::load_all()
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr[, llr := log(rep(1:3, each = 4) / 2)]
fullr
sllh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1),
max_duration = exp(1))
sllh <- spatial_llh(fullr,
null_llh = 2,
L = exp(1),
max_duration = exp(1))
sllh
expect_equal(sllh[, llh],
log(1:3) + 2 - 1 - 1)
sllh[, exp(llh)]
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr[, llr := log(rep(1:3, each = 4) / 4)]
sllh <- spatial_llh(fullr,
null_llh = 2,
L = exp(1),
max_duration = exp(1))
expect_equal(sllh[, llh],
log(1:3) + 2 - 1 - 1)
devtools::test()
devtools::test()
devtools::test()
devtools::test()
devtools::load_all()
streams <- 1:2
times <- 0:1
severities <- 1
events <- 1:1
locations <- 1:2
regions <- list(1:1, 2:2, 1:2)
DT <- table_creator(list(stream = streams,
time = times,
severity = severities,
event = events,
location = locations))
DT <- region_joiner(DT, regions)
# Set keys based on reverse order of use
setkeyv(DT, c("region", "event", "time", "severity", "stream"))
# log-likelihood ratios (LLR) for each individual observation
DT[, llr := c(1:8, rep(9:12 / 2, each = 2))]
DT
DT2 <- DT[, .(llr = sum(llr)), by = .(region, event, time, severity, stream)]
DT2
DT2[, llr := rep(1:6, each = 2) / 2]
DT2
DT3 <- DT2[, .(llr = sum(llr)), by = .(region, event, time, severity)]
DT3
devtools::test()
devtools::document()
devtools::test()
DT3
llrs <- data.table(region = rep(1:3, each = 3),
event = rep(1, 9),
time = rep(0:2, 3),
severity = rep(1, 9))
llrs
getkeys(DT3)
setkeyv(llrs, c("region", "event", "time", "severity"))
llrs
getkeys(llrs)
cumsum(1:3)
cumsum(1:2)
devtools::load_all()
llrs <- data.table(region = rep(1:3, each = 3),
event = rep(1, 9),
time = rep(0:2, 3),
severity = rep(1, 9))
setkeyv(llrs, c("region", "event", "time", "severity"))
llrs[, llr := 1:9]
llrs
duration_llr <- full_llr(llrs)
duration_llr
expect_equal(duration_llr[, llr],
c(cumsum(1:3), cumsum(4:6), cumsum(7:9)))
getkeys(duration_llr)
devtools::test()
duration_llr
llrs <- data.table(region = rep(1:3, each = 3),
event = rep(1, 9),
time = rep(0:2, 3),
severity = rep(1, 9))
setkeyv(llrs, c("region", "event", "time", "severity"))
llrs[, llr := 1:9]
llrs
getkeys(llrs)
devtools::test()
devtools::document()
devtools::test()
devtools::test()
duration_llr
DT3 <- DT2[, .(llr = sum(llr)), by = .(region, event, time, severity)]
DT3[, llr := c(0.5, 0.5)]
DT4 <- DT3[, .(time = time, llr = cumsum(llr)), by = .(region, event, severity)]
DT4
DT5 <- DT4[, .(llh = logsumexp(llr)), by = .(region, event, time)]
DT5
getkeys(DT5)
duration_llr
a <- rbind(duration_llr)
a
a <- rbind(duration_llr, duration_llr)
a
a[, event := rep(1:2, each = 9)]
a
getkeys(duration_llr)
setkeyv(a, c("region", "event", "severity"))
a
getkeys(a)
getkeys(duration_llr)
a
a <- rbind(duration_llr)
a
a <- rbind(duration_llr, duration_llr)
a
duration_llr
DT3
a <- rbind(DT3, DT3)
a
getkeys(duration_llr)
a
setkeyv(a, getkeys(duration_llr))
a
duration_llr
duration_llr[time != 2]
a <- rbind(duration_llr[time != 2], duration_llr[time != 2])
a
setkeyv(a, getkeys(duration_llr))
a
a <- rbind(duration_llr[time != 2], duration_llr[time != 2])
a
a[, severity = rep(1:2, each = 6)]
a
a[, severity := rep(1:2, each = 6)]
a
setkeyv(a, getkeys(duration_llr))
a
getkeys(duration_llr)
a
fullr <- data.table(region = rep(1:3, each = 4),
event = rep(1, 12),
severity = rep(0:1, 3, each = 2),
time = rep(0:1, 6))
fullr
getkeys(duration_llr)
setkeyv(fullr, c("region", "event", "severity"))
fullr
duration_llr
fullr <- data.table(region = rep(1:3, each = 4),
event = rep(1, 12),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6))
setkeyv(fullr, c("region", "event", "severity"))
fullr
fullr[, llr := log(rep(1:6, each = 2) / 2)]
fullr
as.vector(rbind(1:6, 1:6))
?seq
??interlace
interlace <- function(x, y) {
as.vector(rbind(x, y))
}
seq(1, 6, 2)
fullr[, llr := log(c(1,2,1,2,3,4,3,4,5,6,5,6) / 2)]
fullr
devtools::load_all()
stllh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1))
stllh
expect_equal(stllh[, llh],
log(1:6) + 2 - 1)
getkeys(stllg)
getkeys(stllh)
devtools::load_all()
fullr <- data.table(region = rep(1:3, each = 4),
event = rep(1, 12),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6))
setkeyv(fullr, c("region", "event", "severity"))
fullr[, llr := log(c(1,2,1,2,3,4,3,4,5,6,5,6) / 2)]
getkeys(fullr)
stllh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1))
getkeys(stllh)
devtools::test()
fullr
getkeys(fullr)
stllh
devtools::document()
devtools::test()
devtools::document()
?spacetime_llh
devtools::test()
devtools::document()
devtools::load_all()
?spatial_llh
devtools::test()
devtools::document()
devtools::load_all()
log(10^6)
log(10^10)
x <- 2
x[1]
library(devtools)
dev_mode(on=T)
install_github("bookdown")
hadley
?install_github
install_github("hadley/bookdown")
dev_mode(on=F)
devtools::install_github("adletaw/captioner")
install.packages("jpeg")
install.packages(c("lubridate", "rvest", "mgcv", "nlme", "effects", "broom", "hexbin", "maps", "Hmisc"))
devtools::github_install("rstudio/rmarkdown")
library(rmarkdown)
library(captioner)
library(bookdown)
install_github("hadley/bookdown")
library(bookdown)
fullr <- data.table(region = rep(1:3, each = 4),
event = rep(1, 12),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6))
setkeyv(fullr, c("region", "event", "severity"))
fullr[, llr := log(c(1,2,1,2,3,4,3,4,5,6,5,6) / 2)]
stllh <- spacetime_llh(fullr,
null_llh = 2,
L = exp(1))
null_llh
stllh
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr[, llr := log(rep(1:3, each = 4) / 4)]
# add 2, subtract 1, subtract 1 from logsumexp(llh)
sllh <- spatial_llh(fullr,
null_llh = 2,
L = exp(1),
max_duration = exp(3))
sllh
getkeys(sllh)
a <- rbind(sllh, sllh)
a
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3),
llh = 1:6,
keys = c("region", "event"))
sllh
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3),
llh = 1:6,
key = c("region", "event"))
sllh
fullr <- data.table(event = rep(1, 12),
region = rep(1:3, each = 4),
severity = rep(1:2, 3, each = 2),
time = rep(0:1, 6),
key = c("event", "region", "time"))
fullr[, llr := log(rep(1:3, each = 4) / 4)]
sllh <- spatial_llh(fullr,
null_llh = 2,
L = exp(1),
max_duration = exp(3))
sllh
getkeys(sllh)
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3))
setkeyv(sllh, c("region", "event"))
sllh
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3))
setkeyv(sllh, c("region", "event"))
sllh[, llh := 1:6]
sllh
logsumexp(1:2)
?lse
devtools::test()
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3))
setkeyv(sllh, c("region", "event"))
sllh[, llh := 1:6]
event_llh <- logsumexp_llh_over_regions(sllh)
event_llh
sllh
sllh <- data.table(region = rep(1:3, 2),
event = rep(1:2, each = 3),
llh = 1:6)
sllh
setkeyv(sllh, c("region", "event"))
sllh
event_llh <- logsumexp_llh_over_regions(sllh)
event_llh
devtools::test()
event_llh
logsumexp(1:3)
logsumexp(4:6)
devtools::test()
