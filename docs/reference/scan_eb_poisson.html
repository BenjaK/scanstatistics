<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate the expectation-based Poisson scan statistic. — scan_eb_poisson • scanstatistics</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">scanstatistics</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/make_data.html">Process data</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to scanstatistics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/BenjaK/scanstatistics">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate the expectation-based Poisson scan statistic.</h1>
    </div>

    
    <p>Calculate the expectation-based Poisson scan statistic devised by Neill et 
al. (2005).</p>
    

    <pre class="usage"><span class='fu'>scan_eb_poisson</span>(<span class='no'>counts</span>, <span class='no'>zones</span>, <span class='kw'>baselines</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>population</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n_mcsim</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>max_only</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>counts</th>
      <td><p>A matrix of observed counts. Rows indicate time and are ordered
from least recent (row 1) to most recent (row <code>nrow(counts)</code>).
Columns indicate locations, numbered from 1 and up.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p>A list of integer vectors. Each vector corresponds to a single
zone; its elements are the numbers of the locations in that zone.</p></td>
    </tr>
    <tr>
      <th>baselines</th>
      <td><p>A matrix of the same dimensions as <code>counts</code>. Holds the
Poisson mean parameter for each observed count. Will be estimated if not 
supplied (requires the <code>population</code> argument). These parameters are 
typically estimated from past data using e.g. Poisson (GLM) regression.</p></td>
    </tr>
    <tr>
      <th>population</th>
      <td><p>A matrix or vector of populations for each location. Only
needed if <code>baselines</code> are to be estimated and you want to account for
the different populations in each location (and time). If a matrix, should 
be of the same dimensions as <code>counts</code>. If a vector, should be of the 
same length as the number of columns in <code>counts</code>.</p></td>
    </tr>
    <tr>
      <th>n_mcsim</th>
      <td><p>A non-negative integer; the number of replicate scan
statistics to generate in order to calculate a \(P\)-value.</p></td>
    </tr>
    <tr>
      <th>max_only</th>
      <td><p>Boolean. If <code>FALSE</code> (default) the log-likelihood ratio
statistic for each zone and duration is returned. If <code>TRUE</code>, only the
largest such statistic (i.e. the scan statistic) is returned, along with
the corresponding zone and duration.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with the following components:</p><dl class='dl-horizontal'>
     <dt>MLC</dt><dd><p>A list containing the number of the zone of the most likely
           cluster (MLC), the locations in that zone, the duration of the 
           MLC, the calculated score, the relative risk, and matrices of the 
           observed counts and baselines for each location and time point in 
           the MLC.</p></dd>
     <dt>table</dt><dd><p>A data frame containing, for each combination of zone and
           duration investigated, the zone number, duration, score, relative 
           risk. The table is sorted by score with the top-scoring location 
           on top.If <code>max_only = TRUE</code>, only contains a single row 
           corresponding to the MLC.</p></dd>
     <dt>replicate_statistics</dt><dd><p>A data frame of the Monte Carlo replicates 
           of the scan statistic (if any ), and the corresponding zones and
           durations.</p></dd>
     <dt>MC_pvalue</dt><dd><p>The Monte Carlo \(P\)-value.</p></dd>
     <dt>Gumbel_pvalue</dt><dd><p>A \(P\)-value obtained by fitting a Gumbel 
           distribution to the replicate scan statistics.</p></dd>
     <dt>n_zones</dt><dd><p>The number of zones scanned.</p></dd>
     <dt>n_locations</dt><dd><p>The number of locations.</p></dd>
     <dt>max_duration</dt><dd><p>The maximum duration considered.</p></dd>
   </dl>

    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Neill, D. B., Moore, A. W., Sabhnani, M. and Daniel, K. (2005). 
   <em>Detection of emerging space-time clusters</em>. Proceeding of the 
   eleventh ACM SIGKDD international conference on Knowledge discovery in 
   data mining - KDD ’05, 218.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='co'># Create location coordinates, calculate nearest neighbors, and create zones</span>
<span class='no'>n_locs</span> <span class='kw'>&lt;-</span> <span class='fl'>50</span>
<span class='no'>max_duration</span> <span class='kw'>&lt;-</span> <span class='fl'>5</span>
<span class='no'>n_total</span> <span class='kw'>&lt;-</span> <span class='no'>n_locs</span> * <span class='no'>max_duration</span>
<span class='no'>geo</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rnorm</span>(<span class='no'>n_locs</span> * <span class='fl'>2</span>), <span class='no'>n_locs</span>, <span class='fl'>2</span>)
<span class='no'>knn_mat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='coords_to_knn.html'>coords_to_knn</a></span>(<span class='no'>geo</span>, <span class='fl'>15</span>)
<span class='no'>zones</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='knn_zones.html'>knn_zones</a></span>(<span class='no'>knn_mat</span>)

<span class='co'># Simulate data</span>
<span class='no'>baselines</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rexp</span>(<span class='no'>n_total</span>, <span class='fl'>1</span>/<span class='fl'>5</span>), <span class='no'>max_duration</span>, <span class='no'>n_locs</span>)
<span class='no'>counts</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rpois</span>(<span class='no'>n_total</span>, <span class='fu'>as.vector</span>(<span class='no'>baselines</span>)), <span class='no'>max_duration</span>, <span class='no'>n_locs</span>)

<span class='co'># Inject outbreak/event/anomaly</span>
<span class='no'>ob_dur</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>
<span class='no'>ob_cols</span> <span class='kw'>&lt;-</span> <span class='no'>zones</span><span class='kw'>[[</span><span class='fl'>10</span>]]
<span class='no'>ob_rows</span> <span class='kw'>&lt;-</span> <span class='no'>max_duration</span> + <span class='fl'>1</span> - <span class='fu'>seq_len</span>(<span class='no'>ob_dur</span>)
<span class='no'>counts</span>[<span class='no'>ob_rows</span>, <span class='no'>ob_cols</span>] <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(
  <span class='fu'>rpois</span>(<span class='no'>ob_dur</span> * <span class='fu'>length</span>(<span class='no'>ob_cols</span>), <span class='fl'>2</span> * <span class='no'>baselines</span>[<span class='no'>ob_rows</span>, <span class='no'>ob_cols</span>]),
  <span class='fu'>length</span>(<span class='no'>ob_rows</span>), <span class='fu'>length</span>(<span class='no'>ob_cols</span>))
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>scan_eb_poisson</span>(<span class='kw'>counts</span> <span class='kw'>=</span> <span class='no'>counts</span>,
                       <span class='kw'>zones</span> <span class='kw'>=</span> <span class='no'>zones</span>,
                       <span class='kw'>baselines</span> <span class='kw'>=</span> <span class='no'>baselines</span>,
                       <span class='kw'>n_mcsim</span> <span class='kw'>=</span> <span class='fl'>99</span>,
                       <span class='kw'>max_only</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Benjamin Allévius.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
